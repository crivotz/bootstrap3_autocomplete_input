var autocomplete_data_static={};function autocomplete_get_hidden_field(t){var a=t.attr("data-field-id");return!!a&&(a=a.replace(/(:|\.|\[|\])/g,"\\$1"),$("#"+a))}function autocomplete_query(t){t.typeahead({source:function(a,e){t=this.$element,rows=[];var o=t.attr("name");$.getJSON(t.attr("data-source-query"),{q:a},function(t){autocomplete_data_static[o]={map:[],values:[]},$.each(t,function(t,a){autocomplete_data_static[o].values.push(a[1]),autocomplete_data_static[o].map[a[1]]=a[0]}),e(autocomplete_data_static[o].values)})},updater:function(a){var e=autocomplete_get_hidden_field(t=this.$element);if(e){var o=t.attr("name");e.val(autocomplete_data_static[o].map[a]).trigger("change")}return a},items:t.attr("data-items"),minLength:t.attr("data-min-length"),afterSelect:function(a){var e=t.attr("data-afterSelect")||"";if(""!=e){var o=window[e];"function"==typeof o&&o(a)}}}).on("change",function(t){var a=$(this),e=a.typeahead("getActive"),o=autocomplete_get_hidden_field(a);o&&(e&&e==a.val()||o&&o.val(""))})}$(document).on("turbolinks:load",function(){$('input[data-provide="typeahead"][data-source-array]').each(function(){obj=$(this);var t=JSON.parse(obj.attr("data-source-array").replace(/&quot;/g,'"'));obj.typeahead({source:t,items:obj.attr("data-items"),minLength:obj.attr("data-min-length")})}),$('input[data-provide="typeahead"][data-source]').each(function(){obj=$(this);var t=obj.attr("id");autocomplete_data_static[t]={map:[],values:[]},$.get(obj.attr("data-source"),function(a){$.each(a,function(a,e){autocomplete_data_static[t].values.push(e[1]),autocomplete_data_static[t].map[e[1]]=e[0]}),obj.typeahead({source:autocomplete_data_static[t].values,updater:function(a){return obj_id=$("#"+obj.attr("data-field-id")),obj_id&&obj_id.val(autocomplete_data_static[t].map[a]).trigger("change"),a},items:obj.attr("data-items"),minLength:obj.attr("data-min-length")})},"json")}),$('input[data-provide="typeahead"][data-source-query]').each(function(){autocomplete_query($(this))})});
